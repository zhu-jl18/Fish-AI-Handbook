---
import ContentLayout from '../../layouts/ContentPageLayout.astro';

const section = 'æŠ€æœ¯å‘';
const currentPage = 'tech';
const title = 'æŠ€æœ¯å‘ - å¤§æ¨¡å‹åº”ç”¨å¼€å‘çš„åŸºçŸ³';
const sidebarContent = `
  <a href="/tech" class="active">æŠ€æœ¯å‘æ¦‚è¿°</a>
  <a href="/tech/providers">ä¸»æµæœåŠ¡å•†</a>
  <a href="/tech/management">å¯†é’¥ç®¡ç†</a>
  <a href="/tech/security">å®‰å…¨æœ€ä½³å®è·µ</a>
  <a href="/tech/cost-optimization">æˆæœ¬ä¼˜åŒ–</a>
  <a href="/tech/monitoring">ç›‘æ§ä¸å‘Šè­¦</a>
`;
const headings = [
  { id: 'introduction', text: 'ä»‹ç»', depth: 1 },
  { id: 'importance', text: 'APIå¯†é’¥çš„é‡è¦æ€§', depth: 1 },
  { id: 'types', text: 'å¯†é’¥ç±»å‹ä¸æƒé™', depth: 1 },
  { id: 'lifecycle', text: 'å¯†é’¥ç”Ÿå‘½å‘¨æœŸ', depth: 1 },
  { id: 'common-issues', text: 'å¸¸è§é—®é¢˜', depth: 1 },
  { id: 'getting-started', text: 'å¿«é€Ÿä¸Šæ‰‹æŒ‡å—', depth: 1 }
];
---

<ContentLayout 
  {title}
  {section}
  {currentPage}
  {sidebarContent}
  {headings}
>

## ä»‹ç»

APIå¯†é’¥æ˜¯è®¿é—®å¤§è¯­è¨€æ¨¡å‹æœåŠ¡çš„æ•°å­—é’¥åŒ™ï¼Œæ˜¯æ„å»ºAIåº”ç”¨çš„åŸºç¡€è®¾æ–½ã€‚æ— è®ºæ˜¯OpenAIçš„GPTç³»åˆ—ã€Anthropicçš„Claudeã€è¿˜æ˜¯Googleçš„Geminiï¼Œéƒ½éœ€è¦é€šè¿‡APIå¯†é’¥è¿›è¡Œèº«ä»½è®¤è¯å’ŒæœåŠ¡è°ƒç”¨ã€‚

**æ ¸å¿ƒä½œç”¨**:
- ğŸ” **èº«ä»½è®¤è¯**: éªŒè¯è°ƒç”¨è€…èº«ä»½
- ğŸ’° **è®¡è´¹ç®¡ç†**: è·Ÿè¸ªä½¿ç”¨é‡å’Œè´¹ç”¨  
- ğŸ›¡ï¸ **å®‰å…¨æ§åˆ¶**: æƒé™ç®¡ç†å’Œè®¿é—®æ§åˆ¶
- ğŸ“Š **ä½¿ç”¨ç›‘æ§**: è°ƒç”¨ç»Ÿè®¡å’Œæ€§èƒ½ç›‘æ§

## APIå¯†é’¥çš„é‡è¦æ€§

### 1. è®¿é—®æ§åˆ¶æ ¸å¿ƒ
APIå¯†é’¥æ˜¯AIæœåŠ¡çš„è®¿é—®å‡­è¯ï¼Œæ²¡æœ‰æœ‰æ•ˆå¯†é’¥å°±æ— æ³•è°ƒç”¨ä»»ä½•AIæ¨¡å‹ï¼š
```python
import openai

# é…ç½®APIå¯†é’¥
openai.api_key = "sk-xxxxxxxxxxxxxxxxxxxxxxxx"

# è°ƒç”¨API
response = openai.ChatCompletion.create(
    model="gpt-4",
    messages=[{"role": "user", "content": "Hello!"}]
)
```

### 2. æˆæœ¬ç®¡ç†å·¥å…·
é€šè¿‡APIå¯†é’¥å¯ä»¥ï¼š
- **è·Ÿè¸ªä½¿ç”¨é‡**: æ¯æ¬¡è°ƒç”¨éƒ½ä¼šè®¡è´¹
- **è®¾ç½®é¢„ç®—é™åˆ¶**: é˜²æ­¢æ„å¤–é«˜é¢è´¹ç”¨
- **åˆ†æä½¿ç”¨æ¨¡å¼**: ä¼˜åŒ–è°ƒç”¨ç­–ç•¥
- **å¤šé¡¹ç›®éš”ç¦»**: ä¸åŒé¡¹ç›®ä½¿ç”¨ä¸åŒå¯†é’¥

### 3. å®‰å…¨é˜²æŠ¤å±éšœ
```bash
# ç¯å¢ƒå˜é‡æ–¹å¼ (æ¨è)
export OPENAI_API_KEY="your-api-key"

# é…ç½®æ–‡ä»¶æ–¹å¼ (æ³¨æ„ä¿æŠ¤)
echo "OPENAI_API_KEY=your-api-key" > .env

# é”™è¯¯ç¤ºä¾‹ (ç»å¯¹ä¸è¦è¿™æ ·åš)
const API_KEY = "sk-xxxxx"; // ç¡¬ç¼–ç åœ¨ä»£ç ä¸­
```

## å¯†é’¥ç±»å‹ä¸æƒé™

### ä¸»è¦å¯†é’¥ç±»å‹

#### 1. æœåŠ¡å¯†é’¥ (Service Keys)
- **å…¨æƒé™**: å¯ä»¥è°ƒç”¨æ‰€æœ‰å¯ç”¨æ¨¡å‹
- **é€‚ç”¨åœºæ™¯**: ç”Ÿäº§ç¯å¢ƒã€æœåŠ¡å™¨ç«¯åº”ç”¨
- **å®‰å…¨çº§åˆ«**: æœ€é«˜ï¼Œéœ€è¦ä¸¥æ ¼ä¿æŠ¤

#### 2. é¡¹ç›®å¯†é’¥ (Project Keys)  
- **é¡¹ç›®é™åˆ¶**: åªèƒ½åœ¨ç‰¹å®šé¡¹ç›®ä¸­ä½¿ç”¨
- **é€‚ç”¨åœºæ™¯**: å›¢é˜Ÿåä½œã€é¡¹ç›®éš”ç¦»
- **å®‰å…¨çº§åˆ«**: ä¸­ç­‰ï¼Œä¾¿äºç®¡ç†

#### 3. ç”¨æˆ·å¯†é’¥ (User Keys)
- **ä¸ªäººé™åˆ¶**: ç»‘å®šåˆ°ç‰¹å®šç”¨æˆ·è´¦æˆ·
- **é€‚ç”¨åœºæ™¯**: ä¸ªäººå¼€å‘ã€æµ‹è¯•ç¯å¢ƒ
- **å®‰å…¨çº§åˆ«**: è¾ƒä½ï¼Œä½¿ç”¨çµæ´»

### æƒé™çº§åˆ«å¯¹æ¯”

| æƒé™ç±»å‹ | Service Key | Project Key | User Key |
|----------|-------------|-------------|----------|
| æ¨¡å‹è®¿é—® | âœ… å…¨éƒ¨æ¨¡å‹ | âœ… é¡¹ç›®æ¨¡å‹ | âš ï¸ æœ‰é™æ¨¡å‹ |
| è´¹ç”¨æ§åˆ¶ | âœ… è´¦æˆ·çº§åˆ« | âœ… é¡¹ç›®çº§åˆ« | âš ï¸ ç”¨æˆ·çº§åˆ« |
| å›¢é˜Ÿå…±äº« | âŒ ä¸å»ºè®® | âœ… æ¨è | âŒ ä¸ªäººä½¿ç”¨ |
| ç”Ÿäº§ä½¿ç”¨ | âœ… é€‚åˆ | âœ… é€‚åˆ | âŒ ä¸æ¨è |

## å¯†é’¥ç”Ÿå‘½å‘¨æœŸ

### 1. åˆ›å»ºé˜¶æ®µ
```mermaid
graph LR
    A[æ³¨å†Œè´¦æˆ·] --> B[éªŒè¯èº«ä»½]
    B --> C[é€‰æ‹©å¥—é¤]
    C --> D[ç”Ÿæˆå¯†é’¥]
    D --> E[é…ç½®æƒé™]
```

#### åˆ›å»ºæœ€ä½³å®è·µ
```python
# å¯†é’¥å‘½åè§„èŒƒ
key_naming_pattern = {
    'environment': 'prod/dev/test',
    'project': 'project_name', 
    'purpose': 'api/webhook/integration',
    'version': 'v1/v2/v3'
}

# ç¤ºä¾‹: prod-ecommerce-api-v1
key_name = f"{environment}-{project}-{purpose}-{version}"
```

### 2. é…ç½®é˜¶æ®µ
```yaml
# APIå¯†é’¥é…ç½®æ–‡ä»¶ç¤ºä¾‹
api_keys:
  openai:
    key: "${OPENAI_API_KEY}"
    org_id: "${OPENAI_ORG_ID}"
    models: ["gpt-4", "gpt-3.5-turbo"]
    rate_limit: 1000  # æ¯åˆ†é’Ÿè¯·æ±‚æ•°
    
  anthropic:
    key: "${ANTHROPIC_API_KEY}"
    models: ["claude-2", "claude-instant-1"]
    rate_limit: 500
    
  google:
    key: "${GOOGLE_AI_KEY}"
    models: ["gemini-pro"]
    rate_limit: 300
```

### 3. ä½¿ç”¨é˜¶æ®µ
```python
class APIKeyManager:
    def __init__(self):
        self.keys = self._load_keys()
        self.usage_tracker = UsageTracker()
    
    def get_key(self, provider: str, check_quota: bool = True):
        if check_quota:
            if self.usage_tracker.is_quota_exceeded(provider):
                raise QuotaExceededException(f"{provider} quota exceeded")
        
        return self.keys.get(provider)
    
    def rotate_key(self, provider: str, new_key: str):
        """å¯†é’¥è½®æ¢"""
        old_key = self.keys[provider]
        self.keys[provider] = new_key
        self._backup_old_key(provider, old_key)
        self._update_config(provider, new_key)
```

### 4. ç›‘æ§é˜¶æ®µ
```python
import logging
from datetime import datetime

class KeyUsageMonitor:
    def __init__(self, api_key):
        self.api_key = api_key
        self.logger = logging.getLogger(__name__)
    
    def log_usage(self, endpoint, tokens_used, cost):
        self.logger.info({
            'timestamp': datetime.now().isoformat(),
            'api_key': self.api_key[:8] + "...",  # åªè®°å½•å‰8ä½
            'endpoint': endpoint,
            'tokens': tokens_used,
            'cost': cost
        })
    
    def check_limits(self):
        """æ£€æŸ¥ä½¿ç”¨é™åˆ¶"""
        usage = self.get_current_usage()
        if usage['daily_cost'] > self.daily_limit:
            self.send_alert("Daily cost limit exceeded")
```

### 5. è½®æ¢é˜¶æ®µ
```python
# è‡ªåŠ¨å¯†é’¥è½®æ¢ç­–ç•¥
class KeyRotationStrategy:
    def __init__(self):
        self.rotation_interval = 30  # 30å¤©è½®æ¢ä¸€æ¬¡
        
    def should_rotate(self, key_age_days):
        return key_age_days >= self.rotation_interval
    
    def rotate_if_needed(self, provider):
        key_info = self.get_key_info(provider)
        
        if self.should_rotate(key_info['age_days']):
            new_key = self.generate_new_key(provider)
            self.update_key(provider, new_key)
            self.notify_rotation_complete(provider)
```

## å¸¸è§é—®é¢˜

### 1. å¯†é’¥æ³„éœ²å¤„ç†
```python
# å¯†é’¥æ³„éœ²åº”æ€¥å“åº”
class KeyCompromiseResponse:
    def handle_compromise(self, compromised_key):
        # 1. ç«‹å³æ’¤é”€å¯†é’¥
        self.revoke_key(compromised_key)
        
        # 2. ç”Ÿæˆæ–°å¯†é’¥
        new_key = self.generate_replacement_key()
        
        # 3. æ›´æ–°æ‰€æœ‰ä½¿ç”¨è¯¥å¯†é’¥çš„æœåŠ¡
        self.update_services(new_key)
        
        # 4. é€šçŸ¥ç›¸å…³äººå‘˜
        self.send_security_alert(compromised_key)
        
        # 5. å®¡æŸ¥è®¿é—®æ—¥å¿—
        self.audit_access_logs(compromised_key)
```

### 2. é…é¢ç®¡ç†
```python
# æ™ºèƒ½é…é¢ç®¡ç†
class QuotaManager:
    def __init__(self, monthly_budget=1000):
        self.monthly_budget = monthly_budget
        self.daily_budget = monthly_budget / 30
        
    def check_usage(self):
        current_usage = self.get_current_month_usage()
        remaining_days = self.get_remaining_days()
        
        if remaining_days > 0:
            daily_allowance = (self.monthly_budget - current_usage) / remaining_days
            return min(daily_allowance, self.daily_budget * 1.5)
        
        return 0
    
    def optimize_usage(self):
        """ä½¿ç”¨ä¼˜åŒ–å»ºè®®"""
        suggestions = []
        
        if self.is_approaching_limit():
            suggestions.extend([
                "ä½¿ç”¨æ›´ä¾¿å®œçš„æ¨¡å‹(å¦‚gpt-3.5-turboæ›¿ä»£gpt-4)",
                "å‡å°‘è¾“å‡ºé•¿åº¦é™åˆ¶",
                "å¯ç”¨è¯·æ±‚ç¼“å­˜",
                "ä¼˜åŒ–promptå‡å°‘tokenä½¿ç”¨"
            ])
        
        return suggestions
```

### 3. æ€§èƒ½ä¼˜åŒ–
```python
# APIè°ƒç”¨ä¼˜åŒ–
class OptimizedAPIClient:
    def __init__(self, api_key):
        self.api_key = api_key
        self.cache = Cache(ttl=3600)  # 1å°æ—¶ç¼“å­˜
        self.rate_limiter = RateLimiter(requests_per_minute=60)
    
    async def call_api(self, prompt, model="gpt-3.5-turbo"):
        # æ£€æŸ¥ç¼“å­˜
        cache_key = hash(f"{prompt}:{model}")
        cached_result = self.cache.get(cache_key)
        if cached_result:
            return cached_result
        
        # é€Ÿç‡é™åˆ¶
        await self.rate_limiter.wait()
        
        # è°ƒç”¨API
        try:
            result = await self._make_request(prompt, model)
            self.cache.set(cache_key, result)
            return result
        except Exception as e:
            self.handle_error(e)
            raise
```

## å¿«é€Ÿä¸Šæ‰‹æŒ‡å—

### æ­¥éª¤1ï¼šè·å–APIå¯†é’¥
```bash
# 1. è®¿é—®æä¾›å•†å®˜ç½‘
# OpenAI: https://platform.openai.com/api-keys
# Anthropic: https://console.anthropic.com/
# Google: https://ai.google.dev/

# 2. åˆ›å»ºè´¦æˆ·å¹¶éªŒè¯
# 3. ç”ŸæˆAPIå¯†é’¥
# 4. å¤åˆ¶å¹¶å®‰å…¨å­˜å‚¨å¯†é’¥
```

### æ­¥éª¤2ï¼šç¯å¢ƒé…ç½®
```bash
# åˆ›å»º.envæ–‡ä»¶
echo "OPENAI_API_KEY=your-openai-key" >> .env
echo "ANTHROPIC_API_KEY=your-anthropic-key" >> .env
echo "GOOGLE_AI_KEY=your-google-key" >> .env

# è®¾ç½®æ–‡ä»¶æƒé™ (Linux/Mac)
chmod 600 .env

# åŠ è½½ç¯å¢ƒå˜é‡
source .env
```

### æ­¥éª¤3ï¼šæµ‹è¯•è¿æ¥
```python
import os
import openai
from dotenv import load_dotenv

# åŠ è½½ç¯å¢ƒå˜é‡
load_dotenv()

# é…ç½®APIå¯†é’¥
openai.api_key = os.getenv("OPENAI_API_KEY")

# æµ‹è¯•è°ƒç”¨
try:
    response = openai.ChatCompletion.create(
        model="gpt-3.5-turbo",
        messages=[
            {"role": "user", "content": "æµ‹è¯•APIè¿æ¥"}
        ],
        max_tokens=50
    )
    print("APIè¿æ¥æˆåŠŸ!")
    print(response.choices[0].message.content)
except Exception as e:
    print(f"APIè¿æ¥å¤±è´¥: {e}")
```

### æ­¥éª¤4ï¼šå®ç°åŸºç¡€åº”ç”¨
```python
# ç®€å•çš„AIåŠ©æ‰‹
class SimpleAIAssistant:
    def __init__(self, api_key):
        openai.api_key = api_key
        
    def chat(self, message):
        response = openai.ChatCompletion.create(
            model="gpt-3.5-turbo",
            messages=[
                {"role": "system", "content": "ä½ æ˜¯ä¸€ä¸ªæœ‰ç”¨çš„AIåŠ©æ‰‹"},
                {"role": "user", "content": message}
            ],
            temperature=0.7,
            max_tokens=500
        )
        return response.choices[0].message.content

# ä½¿ç”¨åŠ©æ‰‹
assistant = SimpleAIAssistant(os.getenv("OPENAI_API_KEY"))
response = assistant.chat("è¯·è§£é‡Šä»€ä¹ˆæ˜¯æœºå™¨å­¦ä¹ ")
print(response)
```

APIå¯†é’¥ç®¡ç†æ˜¯AIåº”ç”¨å¼€å‘çš„åŸºç¡€æŠ€èƒ½ã€‚æ­£ç¡®ç†è§£å’Œç®¡ç†APIå¯†é’¥ï¼Œä¸ä»…èƒ½ç¡®ä¿åº”ç”¨çš„æ­£å¸¸è¿è¡Œï¼Œè¿˜èƒ½æœ‰æ•ˆæ§åˆ¶æˆæœ¬ã€ä¿éšœå®‰å…¨ï¼Œå¹¶ä¸ºåº”ç”¨çš„æ‰©å±•æ‰“ä¸‹åšå®åŸºç¡€ã€‚

</ContentLayout>
