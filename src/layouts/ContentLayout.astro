---
import BaseLayout from './BaseLayout.astro'
import Header from '../components/Header.astro'
import LeftSidebar from '../components/LeftSidebar.astro'
import RightSidebar from '../components/RightSidebar.astro'
import { getSidebarForPath } from '../scripts/sidebars'

// æ ¹æ®å½“å‰è·¯å¾„è·å–æ­£ç¡®çš„ä¾§è¾¹æ æ•°æ®
const currentPath = Astro.url.pathname
const sidebarItems = getSidebarForPath(currentPath)

// ä» Astro.props ä¸­è·å–å…¶ä»–å±æ€§
const {
  title,
  section,
  headings = [],
  editPath = null,
} = Astro.props
---

<BaseLayout title={title}>
  <Header
    currentPage={section === 'DEMO'
      ? 'demo'
      : section === 'æŠ€æœ¯å‘'
        ? 'tech'
        : section === 'é…ç½®æŒ‡å—'
          ? 'setup'
        : section === 'Fishæƒ³è¯´'
          ? 'fish-talks'
          : section === 'åŸºç¡€ä½¿ç”¨'
            ? 'basic'
            : section === 'æç¤ºè¯'
              ? 'prompts'
              : section === 'è¿›é˜¶ç©æ³•'
                ? 'advanced'
                : section === 'å¥½ç©çš„'
                  ? 'fun'
                  : section === 'èµ„æºåˆé›†'
                      ? 'resources'
                      : 'home'}
  />

  <div class="content-wrapper">
    <LeftSidebar section={section} items={sidebarItems} />

    <main class="content">
      <div class="content-inner">
        {editPath && (
          <details class="file-path-details">
            <summary class="file-path-summary">ğŸ“ æ–‡ä»¶è·¯å¾„ä¿¡æ¯</summary>
            <div class="file-path-content">
              <code>{editPath}</code>
            </div>
          </details>
        )}
        <slot />
      </div>
    </main>

    <RightSidebar headings={headings} />
  </div>
</BaseLayout>

<style>
  .content-wrapper {
    display: flex;
    margin-top: 60px;
    min-height: calc(100vh - 60px);
  }

  .content {
    flex: 1;
    margin-left: 250px;
    margin-right: 250px;
    padding: 2rem;
    background-color: #000;
  }

  .content-inner {
    max-width: 800px;
    margin: 0 auto;
  }

  .file-path-details {
    background-color: #111;
    border: 1px solid #333;
    border-radius: 6px;
    margin-bottom: 1.5rem;
    padding: 0;
    overflow: hidden;
  }

  .file-path-summary {
    background-color: #1a1a1a;
    color: #ccc;
    cursor: pointer;
    padding: 0.75rem 1rem;
    margin: 0;
    border: none;
    font-size: 0.9rem;
    user-select: none;
    list-style: none;
    transition: background-color 0.2s ease;
  }

  .file-path-summary:hover {
    background-color: #222;
    color: #fff;
  }

  .file-path-summary::marker {
    content: none;
  }

  .file-path-summary::-webkit-details-marker {
    display: none;
  }

  .file-path-content {
    padding: 1rem;
    background-color: #0a0a0a;
    border-top: 1px solid #333;
  }

  .file-path-content code {
    background-color: #1e1e1e;
    color: #4a9eff;
    padding: 0.5rem;
    border-radius: 4px;
    font-family: 'Courier New', monospace;
    display: block;
    word-break: break-all;
  }


  @media (max-width: 1024px) {
    .left-sidebar,
    .right-sidebar {
      display: none;
    }

    .content {
      margin-left: 0;
      margin-right: 0;
    }
  }
</style>