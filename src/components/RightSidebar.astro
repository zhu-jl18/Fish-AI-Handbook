---
// 自动化目录（TOC）组件：在客户端扫描正文 h2/h3/h4 构建目录
// 内容作者无需在各页面传入 headings，完全解耦内容与目录
import '../styles/right-sidebar.css'
const { headings = [] } = Astro.props
---

<div class="right-sidebar">
  <div class="toc-content">
    <div class="toc-title">目录</div>
    <nav class="toc-nav"></nav>
    <button class="back-to-top" aria-label="返回顶部" title="返回顶部">
      <svg aria-hidden="true" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M5 15l7-7 7 7"/>
        <path d="M12 19V8"/>
      </svg>
      <span class="visually-hidden">返回顶部</span>
    </button>
  </div>
</div>

<script type="module">
  import { setupRightSidebar } from '/scripts/toc.js'
  // 构建目录并启用滚动高亮
  const stop = setupRightSidebar('.content-inner', '.toc-nav')
  const btn = document.querySelector('.right-sidebar .back-to-top')
  if (btn)
    btn.addEventListener('click', () => {
      window.scrollTo({ top: 0, behavior: 'smooth' })
    })
  if (import.meta?.hot) {
    import.meta.hot.on('vite:beforeUpdate', () => stop && stop())
  }
</script>
